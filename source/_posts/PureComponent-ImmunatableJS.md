---
title: PureComponent_&&_ImmunatableJS
date: 2017-09-30 10:09:10
tags: [React, ImmutableJs, PureComponent]
---

  对于前端目前流行的两大框架React、Vue来说，组件化、高性能、Virtual Dom是他们脱颖而出的特点；对于使用该两大框架的前端开发者来说，在开发过程中只需要关注数据层，至于UI视图层如何变化更新，完全由框架内部机制决定；频繁、大量操作dom是影响前端界面渲染性能的极大祸源，虽然VirtualDom和Diff算法很大程度上解决了这一痛点，但是这两大神器也是根据我们转交给他们的数据来决定如何渲染，渲染更新何处dom的；所以，如果我们可以在将数据交给Virtual Dom 和Diff处理之前对之进行精心处理一番，定能将性能提升又一个高度；

## 牵涉到JavaScript变量类型和React渲染机制，该部分知识请自行补充，本文不做详述；

<!--more-->

## PureComponent

  PureComponent和Component基本一样，但是PureComponent会在render之前对组件前后两次数据执行一次浅比较，来决定是否更新组件，但毕竟是浅比较所以只会比较第一层；当组件的props和state：

1. 引用和第一层数据都没有发生变化，render函数不会触发；
2. 第一层数据没变，但引用变了，就会产生额外的性能浪费；
3. 第一层数据改变，但是引用没变，就会造成不渲染，所以对数据的操作一定要小心；

## Immutable.js

  Immutable.js是持久性数据结构的库，数据一旦创建，就不能再被修改，任何修改、添加、删除操作都会返回一个新的Immutable对象；这样可以让我们更容易地去处理缓存、回退、数据变化检测等问题，可以简易开发；ImmutableJs提供了大量的API去更新、删除、添加数据，极大方便了我们操纵数据，还提供了原生类型与ImmutableJs类型判断与转换的方法；

## ImmutableJS两大特性

1. 持久性数据结构：保证数据一旦创建就不能修改；
2. 结构共享： 没有改变的数据共用一个引用；
![ImmutableJs Tree](https://user-gold-cdn.xitu.io/2017/9/29/6268579e0f3c922db1ce39de89ef8598?imageView2/0/w/1280/h/960)
左边是旧值，右边是新值，我们如果改变了左边红色节点的值，生成的新值就改变了红色节点到根节点路径间的所有节点，就是青色节点的值，其他值没有任何改变，所以大半部分的蓝色节点还是和旧值共享的；
